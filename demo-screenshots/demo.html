<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOC Demo - Storm Spirit Blog</title>
    <style>
        /* Base styles matching your blog */
        * { box-sizing: border-box; }
        body {
            font-family: "HelveticaNeue-Light","Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e0e0e0;
            color: #333;
        }
        .content {
            margin: 0 auto;
            max-width: 840px;
        }
        .main {
            max-width: 90%;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }
        .post {
            position: relative;
        }
        .post-header {
            text-align: center;
            margin-bottom: 2em;
        }
        .post-title {
            font-size: 2em;
            margin: 0.5em 0;
        }
        .post-content {
            line-height: 1.8;
            font-size: 16px;
        }
        .post-content h2 {
            background-color: #9C0;
            padding-left: 5px;
            border: 1px groove #999;
            margin-top: 2em;
        }
        .post-content h3 {
            margin-top: 1.5em;
            color: #333;
        }
        .post-content h4 {
            margin-top: 1.2em;
            color: #666;
        }
        .post-content p {
            margin: 1em 0;
        }

        /* TOC Styles */
        .toc-sidebar {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 240px;
            max-height: calc(100vh - 40px);
            background: #e0e0e0;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 1em;
            overflow-y: auto;
            z-index: 100;
            font-size: 0.9em;
        }
        .toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8em;
            padding-bottom: 0.5em;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            color: #333;
        }
        .toc-close {
            display: none;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            padding: 0;
            line-height: 1;
        }
        .toc-close:hover {
            color: #333;
        }
        .toc-nav a {
            display: block;
            color: #666;
            text-decoration: none;
            padding: 0.3em 0;
            border-bottom: none;
            line-height: 1.4;
            transition: color 0.2s;
        }
        .toc-nav a:hover {
            color: #008D00;
        }
        .toc-nav a.active {
            color: #008D00;
            font-weight: 500;
        }
        .toc-nav .toc-h2 {
            padding-left: 0;
        }
        .toc-nav .toc-h3 {
            padding-left: 1em;
            font-size: 0.95em;
        }
        .toc-nav .toc-h4 {
            padding-left: 2em;
            font-size: 0.9em;
        }

        /* Mobile toggle button */
        .toc-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #333;
            color: #e0e0e0;
            border: none;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s;
            align-items: center;
            justify-content: center;
        }
        .toc-toggle:hover {
            background: #666;
        }

        /* Mobile responsive */
        @media screen and (max-width: 1200px) {
            .toc-sidebar {
                right: -280px;
                width: 260px;
                top: 0;
                max-height: 100vh;
                border-radius: 0;
                border-right: none;
                transition: right 0.3s ease-in-out;
                box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            }
            .toc-sidebar.toc-open {
                right: 0;
            }
            .toc-close {
                display: block;
            }
            .toc-toggle {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div class="content">
        <div class="main">
            <div class="post">
                <header class="post-header">
                    <h1 class="post-title">博客文章示例 - 大纲视图演示</h1>
                </header>

                <article class="post-content">
                    <p>这是一篇示例文章，用于展示右侧大纲视图的效果。在桌面浏览器上（宽度 > 1200px），您可以看到右侧固定的目录栏。在移动设备上（宽度 ≤ 1200px），点击右下角的圆形按钮可以打开目录。</p>

                    <h2 id="section-1">第一章 引言</h2>
                    <p>这是第一章的内容。当您滚动页面时，目录中对应的项目会高亮显示当前阅读的章节。</p>
                    <p>目录会自动从文章中的 h2, h3, h4 标题生成，无需手动维护。</p>

                    <h3 id="section-1-1">1.1 背景介绍</h3>
                    <p>这是一个子章节，在目录中会有缩进显示。点击目录中的任何链接，页面会平滑滚动到对应的位置。</p>

                    <h3 id="section-1-2">1.2 技术选型</h3>
                    <p>实现采用了纯 JavaScript，不依赖任何第三方库。使用 IntersectionObserver API 来检测当前可见的标题。</p>

                    <h4 id="section-1-2-1">1.2.1 前端技术</h4>
                    <p>四级标题在目录中会有更深的缩进，便于区分层级关系。</p>

                    <h2 id="section-2">第二章 功能特性</h2>
                    <p>大纲视图具有以下特性：</p>
                    <ul>
                        <li>桌面端固定在右侧，始终可见</li>
                        <li>移动端从右侧滑入，节省屏幕空间</li>
                        <li>自动高亮当前阅读的章节</li>
                        <li>平滑滚动到目标位置</li>
                        <li>响应式设计，适配各种屏幕</li>
                    </ul>

                    <h3 id="section-2-1">2.1 桌面端体验</h3>
                    <p>在大于 1200px 的屏幕上，目录固定显示在右侧，宽度为 240px。当内容较多时，目录区域可以独立滚动。</p>

                    <h3 id="section-2-2">2.2 移动端体验</h3>
                    <p>在小于等于 1200px 的屏幕上，目录默认隐藏。点击右下角的圆形按钮可以打开目录，点击目录中的链接或者点击目录外的区域会关闭目录。</p>

                    <h2 id="section-3">第三章 实现细节</h2>
                    <p>实现过程中注重最小化改动，只修改了 4 个文件：</p>

                    <h3 id="section-3-1">3.1 HTML 结构</h3>
                    <p>在 _layouts/post.html 中添加了 TOC 侧边栏和移动端切换按钮的 HTML 结构。</p>

                    <h3 id="section-3-2">3.2 样式定义</h3>
                    <p>创建了独立的 _sass/toc.scss 文件来定义目录的样式，包括桌面端和移动端的响应式布局。</p>

                    <h3 id="section-3-3">3.3 JavaScript 逻辑</h3>
                    <p>在 assets/javascripts/app.js 中添加了 initTOC 函数，负责：</p>
                    <ul>
                        <li>提取文章中的标题</li>
                        <li>生成目录 HTML</li>
                        <li>处理点击事件和滚动效果</li>
                        <li>使用 IntersectionObserver 实现高亮</li>
                        <li>处理移动端的显示/隐藏逻辑</li>
                    </ul>

                    <h2 id="section-4">第四章 总结</h2>
                    <p>这个大纲视图功能类似 fumadocs 的设计，提供了良好的阅读体验。代码简洁，易于维护，并且完全响应式。</p>

                    <h3 id="section-4-1">4.1 优势</h3>
                    <p>相比传统的目录实现，这个方案的优势在于：</p>
                    <ul>
                        <li>自动生成，无需手动维护</li>
                        <li>实时高亮当前章节</li>
                        <li>移动端友好</li>
                        <li>改动最小，不影响现有功能</li>
                    </ul>

                    <h3 id="section-4-2">4.2 未来改进</h3>
                    <p>后续可以考虑添加：</p>
                    <ul>
                        <li>目录的折叠/展开功能</li>
                        <li>记住用户的显示偏好</li>
                        <li>更多的主题样式选项</li>
                    </ul>

                    <p style="margin-top: 3em; padding: 2em; background: #f0f0f0; border-left: 4px solid #9C0;">
                        <strong>提示：</strong>尝试滚动页面，观察右侧目录的高亮效果。在移动视图下（缩小浏览器窗口到 1200px 以下），您会看到右下角出现一个圆形按钮，点击它可以打开目录。
                    </p>
                </article>

                <!-- Table of Contents -->
                <aside id="toc-sidebar" class="toc-sidebar">
                    <div class="toc-header">
                        <span>目录</span>
                        <button id="toc-close" class="toc-close" aria-label="关闭目录">&times;</button>
                    </div>
                    <nav id="toc-nav" class="toc-nav"></nav>
                </aside>
                <button id="toc-toggle" class="toc-toggle" aria-label="打开目录">
                    <span class="toc-icon">☰</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            function initTOC() {
                var tocNav = document.getElementById('toc-nav');
                var tocSidebar = document.getElementById('toc-sidebar');
                var tocToggle = document.getElementById('toc-toggle');
                var tocClose = document.getElementById('toc-close');

                if (!tocNav || !tocSidebar) return;

                var postContent = document.querySelector('.post-content');
                if (!postContent) return;

                var headings = postContent.querySelectorAll('h2, h3, h4');
                if (headings.length === 0) {
                    tocSidebar.style.display = 'none';
                    if (tocToggle) tocToggle.style.display = 'none';
                    return;
                }

                var tocHTML = '';
                headings.forEach(function(heading, index) {
                    if (!heading.id) {
                        heading.id = 'heading-' + index;
                    }

                    var level = heading.tagName.toLowerCase();
                    var text = heading.textContent;
                    var link = '#' + heading.id;

                    tocHTML += '<a href="' + link + '" class="toc-' + level + '" data-target="' + heading.id + '">' +
                               text + '</a>';
                });

                tocNav.innerHTML = tocHTML;

                var tocLinks = tocNav.querySelectorAll('a');
                tocLinks.forEach(function(link) {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        var targetId = this.getAttribute('data-target');
                        var target = document.getElementById(targetId);

                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });

                            if (window.innerWidth <= 1200) {
                                tocSidebar.classList.remove('toc-open');
                            }
                        }
                    });
                });

                var observerOptions = {
                    rootMargin: '-100px 0px -66%',
                    threshold: 0
                };

                var observer = new IntersectionObserver(function(entries) {
                    entries.forEach(function(entry) {
                        var id = entry.target.id;
                        var tocLink = tocNav.querySelector('a[data-target="' + id + '"]');

                        if (entry.isIntersecting && tocLink) {
                            tocLinks.forEach(function(link) {
                                link.classList.remove('active');
                            });
                            tocLink.classList.add('active');
                        }
                    });
                }, observerOptions);

                headings.forEach(function(heading) {
                    observer.observe(heading);
                });

                if (tocToggle) {
                    tocToggle.addEventListener('click', function() {
                        tocSidebar.classList.add('toc-open');
                    });
                }

                if (tocClose) {
                    tocClose.addEventListener('click', function() {
                        tocSidebar.classList.remove('toc-open');
                    });
                }

                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 1200 &&
                        tocSidebar.classList.contains('toc-open') &&
                        !tocSidebar.contains(e.target) &&
                        !tocToggle.contains(e.target)) {
                        tocSidebar.classList.remove('toc-open');
                    }
                });
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTOC);
            } else {
                initTOC();
            }
        })();
    </script>
</body>
</html>
