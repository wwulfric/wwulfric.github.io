<!DOCTYPE html> <html class='borderbox'> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Mac 下 pyenv 安装的 Python3 报 KeyError PYTHONPATH 错</title> <meta name="description" content="这是我的中文博客，记录自己在技术、生活等方面的一些感想。博客叫 Storm Spirit， 因为我特别喜欢 Dota 里蓝猫这个英雄，可惜玩得不好…… 希望自己能够通过博客，得到成长。 "> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://wwulfric.github.io/%E6%8A%80%E6%9C%AF/2016/09/22/pyenv-keyerror.html"> <script src="/js/jquery-2.1.1.min.js"></script> <script src="/js/jquery.modal.min.js"></script> <script src="/js/main.js"></script> </head> <body> <div class='content'> <header> <a class="site-title" href="/">Storm Spirit</a> </header> <div class="post typo"> <header class="post-header clearfix"> <div class='date pull-left clearfix'> <div class='day-month pull-left'> <div class='day'>22</div> <div class='month'>SEP</div> </div> <div class='year pull-left'>2016</div> </div> <h1 class="post-title">Mac 下 pyenv 安装的 Python3 报 KeyError PYTHONPATH 错</h1> </header> <blockquote id='by-nc-nd'> 声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh_TW" rel="nofollow" target="_blank" title="姓名标示-非商业性-禁止改作4.0国际">CC BY-NC-ND 4.0</a> 授权。 </blockquote> <article class="post-content"> <p>Error in sitecustomize; set PYTHONVERBOSE for traceback: KeyError: ‘PYTHONPATH’</p> <p>系统不知道更改了什么之后就遇到了这个问题，每当切换目录(<code>cd</code>)的时候都会跳出来错误提示，非常恼人。在 stackoverflow<sup id="fnref:stackoverflow_links"><a href="#fn:stackoverflow_links" class="footnote">1</a></sup> 上没找到解决方法，倒是在一个日文<a href="http://qiita.com/Asakage/items/690ce9048e708de41166">博客</a>里找到了。我也不懂日文，但是看他罗列的文件和代码，大概能了解他的思路，按照思路走，才发现了这个问题。</p> <h2 id="背景">背景</h2> <p>我在 mac 系统上 使用 brew 安装了 Python2.7.10 替代了系统的 Python，之后又使用 pyenv 来管理 Python 的版本，pyenv 中安装了 miniconda 和 miniconda3，默认使用的是miniconda3，也就是 Python3。</p> <h2 id="挖坑">挖坑</h2> <p>首先，<code>cd</code>会出现这个问题的原因是我在<code>.zshrc</code>中执行了<code>eval "$(pyenv init -)</code>，如果删除这一行，就不会有这个问题了。</p> <p>其次，这个问题不仅在 cd 的时候会出现，执行 python 的时候也会。</p> <div class="highlight"><pre><code class="language-python"><span class="o">&gt;</span> <span class="n">python</span>
<span class="n">Error</span> <span class="ow">in</span> <span class="n">sitecustomize</span><span class="p">;</span> <span class="nb">set</span> <span class="n">PYTHONVERBOSE</span> <span class="k">for</span> <span class="n">traceback</span><span class="p">:</span>
<span class="ne">KeyError</span><span class="p">:</span> <span class="s1">&#39;PYTHONPATH&#39;</span>
<span class="n">Python</span> <span class="mf">3.5</span><span class="o">.</span><span class="mi">2</span> <span class="o">|</span><span class="n">Continuum</span> <span class="n">Analytics</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.|</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Jul</span>  <span class="mi">2</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
<span class="p">[</span><span class="n">GCC</span> <span class="mf">4.2</span><span class="o">.</span><span class="mi">1</span> <span class="n">Compatible</span> <span class="n">Apple</span> <span class="n">LLVM</span> <span class="mf">4.2</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">425.0</span><span class="o">.</span><span class="mi">28</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;copyright&quot;</span><span class="p">,</span> <span class="s2">&quot;credits&quot;</span> <span class="ow">or</span> <span class="s2">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<span class="c1"># 返回一个 list。着重关心其中一个元素：&#39;/usr/local/lib/python2.7/site-packages&#39;</span></code></pre></div> <p>这里其实就发现问题了，Python3.5 怎么会有 2.7 的 site-packages 呢？</p> <p><code>/usr/local/</code>是 brew 的默认安装路径，继续挖。</p> <h3 id="brew-doctor-看诊断">brew doctor 看诊断</h3> <p>既然可能是 brew 安装的问题，执行<code>brew doctor</code>。</p> <div class="highlight"><pre><code class="language-bash">Warning: Your default Python does not recognize the Homebrew site-packages
directory as a special site-packages directory, which means that .pth
files will not be followed. This means you will not be able to import
some modules after installing them with Homebrew, like wxpython. To fix
this <span class="k">for</span> the current user, you can run:
  mkdir -p /Users/username/.local/lib/python3.5/site-packages
  <span class="nb">echo</span> <span class="s1">&#39;import site; site.addsitedir(&quot;/usr/local/lib/python2.7/site-packages&quot;)&#39;</span> &gt;&gt; /Users/username/.local/lib/python3.5/site-packages/homebrew.pth</code></pre></div> <p>这里就是问题所在！brew 在安装某些软件之后，可能需要用户手动做一些后续操作。想起来 brew 更新 Python 的时候，它曾经提示我这样做，于是就直接复制代码执行，结果就导致了这个问题。把homebrew.pth 的内容改成</p> <div class="highlight"><pre><code class="language-python"><span class="kn">import</span> <span class="nn">site</span><span class="p">;</span> <span class="n">site</span><span class="o">.</span><span class="n">addsitedir</span><span class="p">(</span><span class="s2">&quot;/usr/local/lib/python3.5/site-packages&quot;</span><span class="p">)</span></code></pre></div> <p>我分析，其原因应该是 brew 没有安装 Python3，但是通过 pyenv 安装了 Python3，所以 brew 还是按照自己的意思建议你在homebrew.pth 导入 2.7 的site-packages。</p> <div class="footnotes"> <ol> <li id="fn:stackoverflow_links"> <p><a href="http://stackoverflow.com/questions/34981284/pythonpath-error-when-trying-to-activate-a-virtual-environment">python - PYTHONPATH error when trying to activate a virtual environment - Stack Overflow</a>, <a href="http://stackoverflow.com/questions/31601078/keyerror-pythonpath-message-when-updating-anaconda-packahes-on-mac-os-x">python - “KeyError: ‘PYTHONPATH’” message when updating Anaconda packahes on Mac OS X - Stack Overflow</a>, <a href="http://stackoverflow.com/questions/32321973/after-installing-anaconda-i-get-constant-keyerror-pythonpath-messages">python - After installing Anaconda, I get constant “KeyError: ‘PYTHONPATH’” messages - Stack Overflow</a>&nbsp;<a href="#fnref:stackoverflow_links" class="reversefootnote">&#8617;</a></p> </li> </ol> </div> </article> <div id='additional' class='clearfix'> <div id="tags" class='pull-left'> miniconda, python, brew, path </div> <a class='pull-right' href="#comments" rel="modal:open">评论</a> </div> <div id="comments"> <!-- 多说评论框 start --> <div class="ds-thread" data-thread-key="/%E6%8A%80%E6%9C%AF/2016/09/22/pyenv-keyerror.html" data-title="Mac 下 pyenv 安装的 Python3 报 KeyError PYTHONPATH 错" data-url="http://wwulfric.github.io/%E6%8A%80%E6%9C%AF/2016/09/22/pyenv-keyerror.html"></div> <!-- 多说评论框 end --> <!-- 多说公共JS代码 start (一个网页只需插入一次) --> <script type="text/javascript"> var duoshuoQuery = {short_name:"storm-spirit"}; (function() { var ds = document.createElement('script'); ds.type = 'text/javascript';ds.async = true; ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js'; ds.charset = 'UTF-8'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds); })(); </script> <!-- 多说公共JS代码 end --> </div> </div> <footer> <a class="page-link" href="/about/">wulfric</a> © 2013~2014. All rights reserved. </footer> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-54608037-1', 'auto'); ga('send', 'pageview'); </script> </div> </body> </html>
